<!DOCTYPE html>
<!-- saved from url=(0047)http://doc.gold.ac.uk/~lfedd001/three/demo.html -->
<html lang="en" class="mdl-js">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="Access-Control-Allow-Origin" content="*" />
		<title>UMAP VS TSNE</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				color: #ffffff;
				background-color: #ffffff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px;
				width: 100%;
				padding: 5px;
				font-family: Monospace;
				font-size: 13px;
				text-align: center;
				font-weight: bold;
			}
			a {
				color: #fff;
			}
		</style>

		<!-- List items with avatar and action -->
		<style>
			.demo-list-control {
			    width: 230px;
			}

			.demo-list-radio {
			    display: inline;
			}

		</style>
		<style type="text/css">/*
		<div id="__sound-pirate" class="__sound-pirate-at-left">
		<a class="__sound-pirate-to-left"><img src="chrome-extension://naaoeihcbaeganoldlfjnomncgdcdnjf/img/arrowl32.png"></a>
		<a class="__sound-pirate-download" download href=""><img src="chrome-extension://naaoeihcbaeganoldlfjnomncgdcdnjf/img/music32.png"></a>
		<a class="__sound-pirate-to-right"><img src="chrome-extension://naaoeihcbaeganoldlfjnomncgdcdnjf/img/arrowr32.png"></a>
		</div>
		*/
			#__sound-pirate {
			margin: 0 4px 4px 4px;
			padding: 0;
			border: 0;
			box-sizing: border-box;
			width: 32px;
			position: fixed;
			bottom: 0;
			left: 0;
			z-index: 2147483647;
			cursor: pointer;
			transition: left 1s ease; }
			#__sound-pirate.__sound-pirate-at-left:hover .__sound-pirate-to-right {
			display: block; }
			#__sound-pirate.__sound-pirate-at-right:hover .__sound-pirate-to-left {
			display: block; }
			#__sound-pirate.__sound-pirate-at-right {
			left: calc(100% - 32px - 4px); }
			#__sound-pirate * {
			margin: 0;
			padding: 0;
			box-sizing: border-box; }
			#__sound-pirate .__sound-pirate-to-left, #__sound-pirate .__sound-pirate-to-right {
			display: none;
			position: absolute;
			width: 14px;
			top: 0; }
			#__sound-pirate .__sound-pirate-to-left {
			right: 100%; }
			#__sound-pirate .__sound-pirate-to-right {
			left: 100%; }
			#__sound-pirate img {
			display: block; }
			#__sound-pirate .__sound-pirate-download {
			display: block;
			transform: rotate(0turn);
			transition: transform 1s ease; }
		</style>
		<style data-styled-components=""></style>
	</head>




	<body>
		<link rel="stylesheet" href="./UMAP VS TSNE_files/icon">
		<link rel="stylesheet" href="./UMAP VS TSNE_files/material.blue_grey-deep_orange.min.css">
		<script defer="" src="./UMAP VS TSNE_files/material.min.js"></script>

		<script src="./UMAP VS TSNE_files/three.min.js"></script>
		<script src="./UMAP VS TSNE_files/d3.v4.min.js"></script>
		<script src="./UMAP VS TSNE_files/stats.min.js"></script>

		<!-- The drawer is always open in large screens. The header is always shown,
		  even in small screens. -->
		<div class="mdl-layout__container"><div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header has-drawer is-upgraded" data-upgraded=",MaterialLayout">
            <header class="mdl-layout__header is-casting-shadow"><div aria-expanded="false" role="button" tabindex="0" class="mdl-layout__drawer-button"><i class="material-icons">î—’</i></div>
                <div id="header" class="mdl-layout__header-row">
                    <div class="mdl-layout-spacer"></div>
					<nav class="mdl-navigation">
						<h6 id="filename"></h6>
					</nav>
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right is-upgraded" data-upgraded=",MaterialTextfield">

	                    <div class="mdl-textfield__expandable-holder">
	                        <input class="mdl-textfield__input" type="text" name="sample" id="fixed-header-drawer-exp">
	                    </div>
                    </div>
                </div>
			</header>
		        <div class="mdl-layout__drawer" id="drawer" aria-hidden="true">
		            <span class="mdl-layout-title">Audio Explorer</span>
	            	<nav class="mdl-navigation">

						<ul class="demo-list-control mdl-list">
							<li class="mdl-list__item">
								<span class="mdl-list__item-primary-content">
									MFCC
								</span>
								<span class="mdl-list__item-secondary-action">
									<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events is-checked is-upgraded" for="feature-list-option-1" data-upgraded=",MaterialRadio,MaterialRipple">
										<input type="radio" id="feature-list-option-1" class="mdl-radio__button" name="options" value="mfcc" oninput="updateGraph()" onchange="updateGraph()" checked="">
									<span class="mdl-radio__outer-circle"></span><span class="mdl-radio__inner-circle"></span><span class="mdl-radio__ripple-container mdl-js-ripple-effect mdl-ripple--center" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></label>
								</span>
							</li>

							<li class="mdl-list__item">
								<span class="mdl-list__item-primary-content">
									Wavenet
								</span>
								<span class="mdl-list__item-secondary-action">
									<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events is-upgraded" for="feature-list-option-2" data-upgraded=",MaterialRadio,MaterialRipple">
										<input type="radio" id="feature-list-option-2" class="mdl-radio__button" name="options" value="wavenet" oninput="updateGraph()" onchange="updateGraph()">
									<span class="mdl-radio__outer-circle"></span><span class="mdl-radio__inner-circle"></span><span class="mdl-radio__ripple-container mdl-js-ripple-effect mdl-ripple--center" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></label>
								</span>
							</li>
						</ul>
					</nav>

						<hr>

					<nav class="mdl-navigation">
						<ul class="demo-list-control mdl-list">
							<li class="mdl-list__item">
								<span class="mdl-list__item-primary-content">
									UMAP
								</span>
								<span class="mdl-list__item-secondary-action">
									<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events is-checked is-upgraded" for="method-list-option-1" data-upgraded=",MaterialRadio,MaterialRipple">
										<input type="radio" id="method-list-option-1" class="mdl-radio__button" name="methodoptions" value="umap" oninput="updateGraph()" onchange="updateGraph()" checked="">
									<span class="mdl-radio__outer-circle"></span><span class="mdl-radio__inner-circle"></span><span class="mdl-radio__ripple-container mdl-js-ripple-effect mdl-ripple--center" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></label>
								</span>
							</li>

							<li class="mdl-list__item">
								<span class="mdl-list__item-primary-content">
									t-SNE
								</span>
								<span class="mdl-list__item-secondary-action">
									<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events is-upgraded" for="method-list-option-2" data-upgraded=",MaterialRadio,MaterialRipple">
										<input type="radio" id="method-list-option-2" class="mdl-radio__button" name="methodoptions" value="tsne" oninput="updateGraph()" onchange="updateGraph()">
									<span class="mdl-radio__outer-circle"></span><span class="mdl-radio__inner-circle"></span><span class="mdl-radio__ripple-container mdl-js-ripple-effect mdl-ripple--center" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></label>
								</span>
							</li>


							<li class="mdl-list__item">
								<span class="mdl-list__item-primary-content">
									PCA
								</span>
								<span class="mdl-list__item-secondary-action">
									<label class="demo-list-radio mdl-radio mdl-js-radio mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events is-upgraded" for="method-list-option-3" data-upgraded=",MaterialRadio,MaterialRipple">
										<input type="radio" id="method-list-option-3" class="mdl-radio__button" name="methodoptions" value="pca" oninput="updateGraph()" onchange="updateGraph()">
									<span class="mdl-radio__outer-circle"></span><span class="mdl-radio__inner-circle"></span><span class="mdl-radio__ripple-container mdl-js-ripple-effect mdl-ripple--center" data-upgraded=",MaterialRipple"><span class="mdl-ripple"></span></span></label>
								</span>
							</li>
						</ul>

						<div id="sliders">
							<p style="width:230px">
								</p><div class="mdl-card__supporting-text">
									<p id="slider-text-1">Neighbours</p>
								</div>
								<div class="mdl-slider__container"><input class="mdl-slider mdl-js-slider is-upgraded" type="range" id="slider1" min="1" max="5" step="1" oninput="updateGraph()" onchange="updateGraph()" data-upgraded=",MaterialSlider"><div class="mdl-slider__background-flex"><div class="mdl-slider__background-lower" style="flex: 0.5 1 0%;"></div><div class="mdl-slider__background-upper" style="flex: 0.5 1 0%;"></div></div></div>
								<div class="mdl-card__supporting-text">
									<p id="slider-text-2">Distances</p>
								</div>
								<div class="mdl-slider__container"><input class="mdl-slider mdl-js-slider is-upgraded" type="range" id="slider2" min="1" max="5" step="1" oninput="updateGraph()" onchange="updateGraph()" data-upgraded=",MaterialSlider"><div class="mdl-slider__background-flex"><div class="mdl-slider__background-lower" style="flex: 0.5 1 0%;"></div><div class="mdl-slider__background-upper" style="flex: 0.5 1 0%;"></div></div></div>
							<p></p>
						</div>

		            	<a class="mdl-navigation__link" href="https://medium.com/@LeonFedden">Blog</a>
		            	<a class="mdl-navigation__link" href="https://twitter.com/LeonFedden">Twitter</a>
	            	</nav>
		        </div>
		    <main class="mdl-layout__content">
			    <div class="page-content">
					<!-- Your content goes here -->

					<div id="container"></div>
				</div>
		    </main>
		<div class="mdl-layout__obfuscator"></div></div></div>

		<script type="text/javascript" src="./UMAP VS TSNE_files/data.json"></script>
		<script src="./UMAP VS TSNE_files/webaudiox.js"></script>

		<script>

			// create WebAudio API context
			var context = new AudioContext()

			// Create lineOut
			var lineOut = new WebAudiox.LineOut(context)
			lineOut.volume = 0.4;

			var data = JSON.parse(d);

			function getData(method, feature, a, b) {
				var key;
				if (method.toString() == "pca") {
					key = method.toString() + feature.toString();
				} else if (method.toString() == "tsne") {
					key = method.toString() + feature.toString() + b.toString() + a.toString();
				} else {
					key = method.toString() + feature.toString() + a.toString() + b.toString();
				}
				return data[key];
			}

			var filePaths = data['filenames'];


			var renderer, scene, camera, stats;
			var pointclouds;
			var raycaster;
			var mouse = new THREE.Vector2();
			var intersection = null;
			var spheres = [];
			var spheresIndex = 0;
			var clock;
			var mouseHasMoved = false;
			var sound = null;
			var interpolating = false;
			var interpolatingAmount = 0;
			var interpolationSpeed = 0.01;
			var target = null;
			var previousSampleIndex = -1;
			var threshold = 0.1;
			var pointSize = 2;
			var width = 150;
			var length = 150;

			var drawerWidth = document.getElementById("drawer").clientWidth;
			var titleHeight = document.getElementById("header").clientHeight;
			var renderWidth = window.innerWidth - drawerWidth;
			var renderHeight = window.innerHeight - titleHeight;

			init();
			animate();

			function updateGraph() {
				var slider1 = parseInt(document.getElementById("slider1").value) - 1;
				var slider2 = parseInt(document.getElementById("slider2").value) - 1;

				var method = null;
				var methodOptions = document.getElementsByClassName('mdl-radio__button');
				for (var i = 0; methodOptions[i]; ++i) {
					let id = methodOptions[i].id.toString();
					if (methodOptions[i].checked && (id.indexOf("method") != -1)) {
						method = methodOptions[i].value;
						break;
					}
				}

				var feature = null;
				var featureOptions = document.getElementsByClassName('mdl-radio__button');
				for (var i = 0; featureOptions[i]; ++i) {
					let id = featureOptions[i].id.toString();
					if (featureOptions[i].checked && (id.indexOf("feature") != -1)) {
						feature = featureOptions[i].value;
						break;
					}
				}

				if (method == "umap") {
					document.getElementById("sliders").style.visibility = "visible";
					document.getElementById("slider-text-1").innerHTML = "Neighbours";
					document.getElementById("slider-text-2").innerHTML = "Distances";
				} else if (method == "tsne") {
					document.getElementById("sliders").style.visibility = "visible";
					document.getElementById("slider-text-1").innerHTML = "Perplexity";
					document.getElementById("slider-text-2").innerHTML = "Iterations";
				} else if (method == "pca") {
					document.getElementById("sliders").style.visibility = "hidden";
				}

				let targetData = getData(method, feature, slider1, slider2);
				target = generatePositionsFromData(targetData);
				interpolating = true;
				interpolatingAmount = 0;
			}

			function generatePositionsFromData(data) {

				var positions = new Float32Array(data.length * 3);
				for (var i = 0; i < data.length; ++i) {

					let x = data[i]['coordinates'][0] - 0.5;
					let y = data[i]['coordinates'][1] - 0.5;
					let z = 0;

					positions[3 * i] = x;
					positions[3 * i + 1] = y;
					positions[3 * i + 2] = z;
				}

				return positions;
			}

			function generatePointCloudGeometry(data) {

				var geometry = new THREE.BufferGeometry();
				var positions = generatePositionsFromData(data);

				var colors = new Float32Array(data.length * 3);
				var color = new THREE.Color();
				for (var i = 0; i < data.length; ++i) {

					color.setHSL(0.8, .8, .5);
					colors[3 * i] = color.r;
					colors[3 * i + 1] = color.g;
					colors[3 * i + 2] = color.b;
				}

				geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3));
				geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));
				geometry.computeBoundingBox();

				return geometry;
			}

			function generatePointcloud(data) {

				var geometry = generatePointCloudGeometry(data);

				var material = new THREE.PointsMaterial({
					size: pointSize,
					vertexColors: THREE.VertexColors,
					sizeAttenuation: false
				});
				var pointcloud = new THREE.Points(geometry, material);
				return pointcloud;

			}

			function init() {

				var container = document.getElementById('container');

				scene = new THREE.Scene();

				clock = new THREE.Clock();

				const near_plane = 2;
				const far_plane = 100;

				// Set up camera and scene
				camera = new THREE.PerspectiveCamera(
				    20,
				    renderWidth / renderHeight,
				    near_plane,
				    far_plane
				);

				camera.applyMatrix( new THREE.Matrix4().makeTranslation( 0,0,40 ) );

				let jsonData = getData("umap", "mfcc", 2, 2);
				var pcBuffer = generatePointcloud(jsonData);
				pcBuffer.scale.set(10, 10, 1);
				pcBuffer.position.set(0, 0, 0);
				scene.add( pcBuffer );

				pointclouds = [ pcBuffer ];

				//

				var sphereGeometry = new THREE.SphereGeometry( 0.1, 32, 32 );
				var sphereMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000 } );

				for ( var i = 0; i < 40; i++ ) {

					var sphere = new THREE.Mesh( sphereGeometry, sphereMaterial );
					scene.add( sphere );
					spheres.push( sphere );

				}

				//
				renderWidth = window.innerWidth - drawerWidth;
				renderHeight = window.innerHeight - titleHeight;
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setClearColor(0xffffff, 1);
				renderer.setSize(renderWidth, renderHeight);
				container.appendChild(renderer.domElement);

				//

				raycaster = new THREE.Raycaster();
				raycaster.params.Points.threshold = threshold;

				//

				stats = new Stats();
				container.appendChild( stats.dom );

				//

				window.addEventListener( 'resize', onWindowResize, false );
				document.addEventListener( 'mousemove', onDocumentMouseMove, false );

			}

			function onDocumentMouseMove( event ) {

				mouseHasMoved = true;

				titleHeight = document.getElementById("header").clientHeight;

				if (window.innerWidth >= 1024) {
					drawerWidth = document.getElementById("drawer").clientWidth;
					mouse.x = ( (event.clientX - drawerWidth) / renderWidth ) * 2 - 1;
				} else {
					mouse.x = ( event.clientX /renderWidth ) * 2 - 1;
				}
				mouse.y = - ( (event.clientY - titleHeight) / (renderHeight)) * 2 + 1;
			}

			function onWindowResize() {

				renderWidth = window.innerWidth - drawerWidth;
				renderHeight = window.innerHeight - titleHeight;

				camera.aspect = renderWidth / renderHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( renderWidth, renderHeight );

			}

			function animate() {

				requestAnimationFrame(animate);

				if (interpolating) {
					pointclouds[0].geometry.attributes.position.needsUpdate = true;

					var positions = pointclouds[0].geometry.attributes.position.array;

					interpolatingAmount += interpolationSpeed;

					if (interpolatingAmount >= 1.0) {
						interpolating = false;

						for (var i = 0; i < positions.length; ++i) {
							positions[i] = target[i];
						}
					} else {

						for (var i = 0; i < positions.length; i += 3) {
							positions[i] = THREE.Math.lerp(positions[i], target[i], interpolatingAmount);
							positions[i+1] = THREE.Math.lerp(positions[i+1], target[i+1], interpolatingAmount);
						}
					}
				}


				render();
				stats.update();

			}

			var toggle = 0;

			function render() {

				raycaster.setFromCamera(mouse, camera);

				var intersections = raycaster.intersectObjects( pointclouds );
				intersection = (intersections.length) > 0 ? intersections[0] : null;

				if (toggle > 0.02 && intersection !== null && mouseHasMoved) {

					if (previousSampleIndex != intersection.index) {
						let filepath = filePaths[intersection.index];
						previousSampleIndex = intersection.index;

						// load a sound and play it immediatly
						let file = filepath;
						var localhost = "http://localhost:7000/";
						file = localhost + file;
						console.log(file);
					    WebAudiox.loadBuffer(context, file, function(buffer){
					        // init AudioBufferSourceNode
					        var source  = context.createBufferSource();
					        source.buffer = buffer
					        source.connect(lineOut.destination)

					        // start the sound now
					        source.start(0);
					    });

						document.getElementById("filename").innerHTML = filepath;
					}

					spheres[spheresIndex].position.copy(intersection.point);
					spheres[spheresIndex].scale.set(1, 1, 1);
					spheresIndex = (spheresIndex + 1) % spheres.length;

					toggle = 0;

				}

				for (var i = 0; i < spheres.length; i++) {

					var sphere = spheres[i];
					sphere.scale.multiplyScalar(0.98);
					sphere.scale.clampScalar(0.01, 1);

				}

				toggle += clock.getDelta();

				renderer.render(scene, camera);

			}

		</script>

	


</body></html>